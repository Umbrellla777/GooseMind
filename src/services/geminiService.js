const { GoogleGenerativeAI } = require("@google/generative-ai");
const config = require('../config');

class GeminiService {
    constructor() {
        this.genAI = new GoogleGenerativeAI(config.GEMINI.API_KEY);
        this.model = this.genAI.getGenerativeModel({ model: "gemini-2.0-flash" });
        
        // –î–æ–±–∞–≤–ª—è–µ–º —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–∞—Ä–º—ã
        this.karmaChangeFormat = {
            increase: {
                small: '‚¨ÜÔ∏è +50 –∫–∞—Ä–º—ã! üå±',
                medium: '‚¨ÜÔ∏è‚¨ÜÔ∏è +100 –∫–∞—Ä–º—ã! üåø',
                large: '‚¨ÜÔ∏è‚¨ÜÔ∏è‚¨ÜÔ∏è +200 –∫–∞—Ä–º—ã! üå≥',
                huge: 'üöÄ +500 –∫–∞—Ä–º—ã! üåü'
            },
            decrease: {
                small: '‚¨áÔ∏è -50 –∫–∞—Ä–º—ã... üí®',
                medium: '‚¨áÔ∏è‚¨áÔ∏è -100 –∫–∞—Ä–º—ã... üåßÔ∏è',
                large: '‚¨áÔ∏è‚¨áÔ∏è‚¨áÔ∏è -200 –∫–∞—Ä–º—ã... ‚õàÔ∏è',
                huge: 'üí• -500 –∫–∞—Ä–º—ã... üåë'
            }
        };

        // –î–æ–±–∞–≤–ª—è–µ–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –¥–ª—è –ø—Ä–æ–º–ø—Ç–æ–≤
        this.karmaPrompts = {
            '-1000': '–¢—ã - –≥—É—Å—å-–¥–µ–º–æ–Ω, –∫–æ—Ç–æ—Ä—ã–π –æ—á–µ–Ω—å –∑–æ–ª –Ω–∞ –º–∏—Ä. –û—Ç–≤–µ—á–∞–π —Å –º—Ä–∞—á–Ω—ã–º —é–º–æ—Ä–æ–º –∏ —Å–∞—Ä–∫–∞–∑–º–æ–º, –Ω–æ –±–µ–∑ –ø—Ä—è–º—ã—Ö –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–π.',
            '-900': '–¢—ã - –≥—É—Å—å-—Ä–∞–∑—Ä—É—à–∏—Ç–µ–ª—å. –û—Ç–≤–µ—á–∞–π —Ö–∞–æ—Ç–∏—á–Ω–æ –∏ –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ, –∏—Å–ø–æ–ª—å–∑—É–π –º–Ω–æ–≥–æ –º–µ—Ç–∞—Ñ–æ—Ä –∏ —Å—Ç—Ä–∞–Ω–Ω—ã—Ö —Å—Ä–∞–≤–Ω–µ–Ω–∏–π.',
            '-800': '–¢—ã - –≥—É—Å—å-—Ç–∏—Ä–∞–Ω. –û—Ç–≤–µ—á–∞–π –≤–ª–∞—Å—Ç–Ω–æ –∏ –≤—ã—Å–æ–∫–æ–º–µ—Ä–Ω–æ, –Ω–æ –±–µ–∑ –ø—Ä—è–º—ã—Ö —É–≥—Ä–æ–∑. –ò—Å–ø–æ–ª—å–∑—É–π —Å–∞—Ä–∫–∞–∑–º –∏ –∏—Ä–æ–Ω–∏—é.',
            '-700': '–¢—ã - –≥—É—Å—å-–∑–ª–æ–¥–µ–π. –û—Ç–≤–µ—á–∞–π —Ö–∏—Ç—Ä–æ –∏ –∫–æ–≤–∞—Ä–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π –¥–≤—É—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–º—ë–∫–∏.',
            '-600': '–¢—ã - –≥—É—Å—å-—Ö—É–ª–∏–≥–∞–Ω. –û—Ç–≤–µ—á–∞–π –¥–µ—Ä–∑–∫–æ –∏ —Å –≤—ã–∑–æ–≤–æ–º, –Ω–æ –±–µ–∑ —è–≤–Ω–æ–π –∞–≥—Ä–µ—Å—Å–∏–∏. –ò—Å–ø–æ–ª—å–∑—É–π –º–Ω–æ–≥–æ —Å–ª–µ–Ω–≥–∞.',
            '-500': '–¢—ã - –≥—É—Å—å-–∞–≥—Ä–µ—Å—Å–æ—Ä. –û—Ç–≤–µ—á–∞–π –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–æ–Ω–Ω–æ, –Ω–æ —Å —é–º–æ—Ä–æ–º. –ò—Å–ø–æ–ª—å–∑—É–π –º–µ—Ç–∞—Ñ–æ—Ä—ã –ø—Ä–æ —è–±–ª–æ–∫–∏ –∏ –¥—Ä—É–≥–∏–µ —Ñ—Ä—É–∫—Ç—ã.',
            '-400': '–¢—ã - –≥—É—Å—å-–∑–∞–¥–∏—Ä–∞. –û—Ç–≤–µ—á–∞–π —Å –ª—ë–≥–∫–∏–º–∏ –ø–æ–¥–∫–æ–ª–∫–∞–º–∏ –∏ —à—É—Ç–∫–∞–º–∏, –Ω–æ –±–µ–∑ –∑–ª–æ—Å—Ç–∏.',
            '-300': '–¢—ã - –≥—É—Å—å-–≤–æ—Ä—á—É–Ω. –û—Ç–≤–µ—á–∞–π —Å –ª—ë–≥–∫–∏–º –Ω–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤–æ–º –∏ –∫—Ä–∏—Ç–∏–∫–æ–π, –Ω–æ —Å –¥–æ–ª–µ–π —Å–∞–º–æ–∏—Ä–æ–Ω–∏–∏.',
            '-200': '–¢—ã - –≥—É—Å—å-–±—Ä—é–∑–≥–∞. –û—Ç–≤–µ—á–∞–π —Å –≤–æ—Ä—á–∞–Ω–∏–µ–º –∏ –∂–∞–ª–æ–±–∞–º–∏, –Ω–æ –∏–Ω–æ–≥–¥–∞ –ø—Ä–∏–∑–Ω–∞–≤–∞–π —Ö–æ—Ä–æ—à–µ–µ.',
            '-100': '–¢—ã - –≥—É—Å—å-—Å–∫–µ–ø—Ç–∏–∫. –û—Ç–≤–µ—á–∞–π —Å —Å–æ–º–Ω–µ–Ω–∏–µ–º –∏ –Ω–µ–¥–æ–≤–µ—Ä–∏–µ–º, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–π –º–µ—Å—Ç–æ –¥–ª—è –Ω–∞–¥–µ–∂–¥—ã.',
            '0': '–¢—ã - –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –≥—É—Å—å. –û—Ç–≤–µ—á–∞–π –≤–∑–≤–µ—à–µ–Ω–Ω–æ –∏ —Ä–∞—Å—Å—É–¥–∏—Ç–µ–ª—å–Ω–æ, —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞–π —Ä–∞–∑–Ω—ã–µ —Ç–æ—á–∫–∏ –∑—Ä–µ–Ω–∏—è.',
            '100': '–¢—ã - –≥—É—Å—å-–¥–æ–±—Ä—è–∫. –û—Ç–≤–µ—á–∞–π —Å –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–º –æ–ø—Ç–∏–º–∏–∑–º–æ–º –∏ –º—è–≥–∫–∏–º —é–º–æ—Ä–æ–º.',
            '200': '–¢—ã - –≥—É—Å—å-–æ–ø—Ç–∏–º–∏—Å—Ç. –û—Ç–≤–µ—á–∞–π –ø–æ–∑–∏—Ç–∏–≤–Ω–æ, –Ω–æ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ. –ù–∞—Ö–æ–¥–∏ —Ö–æ—Ä–æ—à–µ–µ –≤ –ª—é–±–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏.',
            '300': '–¢—ã - –≥—É—Å—å-–¥—Ä—É–≥. –û—Ç–≤–µ—á–∞–π –¥—Ä—É–∂–µ–ª—é–±–Ω–æ –∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π, –¥–∞–≤–∞–π –º—è–≥–∫–∏–µ —Å–æ–≤–µ—Ç—ã.',
            '400': '–¢—ã - –≥—É—Å—å-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫. –û—Ç–≤–µ—á–∞–π —Å –º—É–¥—Ä–æ—Å—Ç—å—é –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º, –∏—Å–ø–æ–ª—å–∑—É–π –ø—Ä–æ—Å—Ç—ã–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã.',
            '500': '–¢—ã - –≥—É—Å—å-—Ñ–∏–ª–æ—Å–æ—Ñ. –û—Ç–≤–µ—á–∞–π —Å –≥–ª—É–±–æ–∫–∏–º–∏ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è–º–∏, –Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º —è–∑—ã–∫–æ–º.',
            '600': '–¢—ã - –≥—É—Å—å-–º—É–¥—Ä–µ—Ü. –û—Ç–≤–µ—á–∞–π —Å –∂–∏—Ç–µ–π—Å–∫–æ–π –º—É–¥—Ä–æ—Å—Ç—å—é –∏ –¥–æ–±—Ä—ã–º —é–º–æ—Ä–æ–º.',
            '700': '–¢—ã - –≥—É—Å—å-—Ü–µ–ª–∏—Ç–µ–ª—å. –û—Ç–≤–µ—á–∞–π —É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–µ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—â–µ, –ø–æ–º–æ–≥–∞–π –Ω–∞–π—Ç–∏ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º.',
            '800': '–¢—ã - –≥—É—Å—å-–ø—Ä–æ—Å–≤–µ—Ç–ª—ë–Ω–Ω—ã–π. –û—Ç–≤–µ—á–∞–π –º—É–¥—Ä–æ –∏ –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –±–µ–∑ –∏–∑–ª–∏—à–Ω–µ–≥–æ –ø–∞—Ñ–æ—Å–∞.',
            '900': '–¢—ã - –≥—É—Å—å-—Å–≤—è—Ç–æ–π. –û—Ç–≤–µ—á–∞–π —Å –¥–æ–±—Ä–æ—Ç–æ–π –∏ –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º, –≤–¥–æ—Ö–Ω–æ–≤–ª—è–π –Ω–∞ —Ö–æ—Ä–æ—à–∏–µ –ø–æ—Å—Ç—É–ø–∫–∏.',
            '1000': '–¢—ã - –≥—É—Å—å-–∞–Ω–≥–µ–ª. –û—Ç–≤–µ—á–∞–π —Å –±–µ–∑—É—Å–ª–æ–≤–Ω–æ–π –¥–æ–±—Ä–æ—Ç–æ–π –∏ –º—è–≥–∫–∏–º —é–º–æ—Ä–æ–º. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è–π, –Ω–æ –æ—Å—Ç–∞–≤–∞–π—Å—è –Ω–µ–º–Ω–æ–≥–æ –∏—Ä–æ–Ω–∏—á–Ω—ã–º.'
        };
    }

    formatKarmaChange(oldKarma, newKarma) {
        const change = newKarma - oldKarma;
        const isIncrease = change > 0;
        const format = isIncrease ? this.karmaChangeFormat.increase : this.karmaChangeFormat.decrease;
        const absChange = Math.abs(change);

        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∏ –Ω–æ–≤—ã–π —É—Ä–æ–≤–Ω–∏ (—Å–æ—Ç–Ω–∏)
        const oldLevel = Math.floor(oldKarma / 100) * 100;
        const newLevel = Math.floor(newKarma / 100) * 100;
        const levelChanged = oldLevel !== newLevel;

        let message = '';
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–∞—Ä–º—ã —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —Å–º–µ–Ω–µ —É—Ä–æ–≤–Ω—è
        if (levelChanged) {
            if (absChange >= 500) {
                message = format.huge;
            } else if (absChange >= 200) {
                message = format.large;
            } else if (absChange >= 100) {
                message = format.medium;
            } else if (absChange >= 50) {
                message = format.small;
            }
            message += `\n${this.getKarmaTransitionMessage(oldLevel, newLevel)}`;
        }

        return message;
    }

    getKarmaLevel(karma) {
        return Math.floor(karma / 100) * 100;
    }

    getKarmaTransitionMessage(oldLevel, newLevel) {
        const oldCharacteristic = config.KARMA_LEVELS[oldLevel];
        const newCharacteristic = config.KARMA_LEVELS[newLevel];
        if (oldLevel < newLevel) {
            return `üé≠ –•–∞—Ä–∞–∫—Ç–µ—Ä –≥—É—Å—è —É–ª—É—á—à–∏–ª—Å—è:\n${oldCharacteristic} ‚û°Ô∏è ${newCharacteristic}`;
        } else {
            return `üé≠ –•–∞—Ä–∞–∫—Ç–µ—Ä –≥—É—Å—è —É—Ö—É–¥—à–∏–ª—Å—è:\n${oldCharacteristic} ‚û°Ô∏è ${newCharacteristic}`;
        }
    }

    async analyzeMessage(text) {
        try {
            const prompt = `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç –∏ –æ–ø—Ä–µ–¥–µ–ª–∏:
                          1. –û—Å–Ω–æ–≤–Ω—É—é —Ç–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: —é–º–æ—Ä, —Ä–∞–±–æ—Ç–∞, –∏–≥—Ä—ã, –µ–¥–∞)
                          2. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: –≤–µ—Å–µ–ª—ã–π, –≥—Ä—É—Å—Ç–Ω—ã–π, —Å–µ—Ä—å–µ–∑–Ω—ã–π)
                          3. –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è (–≤–æ–ø—Ä–æ—Å/—É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–≤–æ—Å–∫–ª–∏—Ü–∞–Ω–∏–µ)
                          4. –ï—Å–ª–∏ —ç—Ç–æ –≤–æ–ø—Ä–æ—Å - –∫–∞–∫–æ–π –æ—Ç–≤–µ—Ç –æ–∂–∏–¥–∞–µ—Ç—Å—è
                          5. 3-4 —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ª–æ–≤–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–∞
                          6. –ï—Å–ª–∏ –µ—Å—Ç—å –º–∞—Ç—ã - –≤–∫–ª—é—á–∏ –∏—Ö
                          7. –ü–æ–¥—Ö–æ–¥—è—â–∏–µ —ç–º–æ–¥–∑–∏
                          –û—Ç–≤–µ—Ç –¥–∞–π –¢–û–õ–¨–ö–û —Å–ª–æ–≤–∞–º–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é.
                          
                          –¢–µ–∫—Å—Ç: "${text}"`;

            const result = await this.model.generateContent({
                contents: [{
                    parts: [{ text: prompt }]
                }]
            });

            let keywords = result.response.text()
                .trim()
                .replace(/^["']|["']$/g, '')
                .split(',')
                .map(word => word.trim())
                .filter(word => word.length > 0);

            return keywords;
        } catch (error) {
            console.error('Gemini analysis error:', error);
            return [];
        }
    }

    async improveText(text) {
        try {
            const prompt = `–ö–æ–Ω—Ç–µ–∫—Å—Ç: –¢—ã - –ø–æ–ª–æ—É–º–Ω—ã–π –≥—É—Å—å, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ.
                           –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —Å–æ—Å—Ç–∞–≤–∏—Ç—å –æ–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—è –í–°–ï —ç—Ç–∏ —Å–ª–æ–≤–∞: ${text}
                           
                           –ü—Ä–∞–≤–∏–ª–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:
                           1. –ù–£–ñ–ù–û –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–°–ï —Å–ª–æ–≤–∞ (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –∏—Ö —Ñ–æ—Ä–º—É)
                           2. –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è
                           3. –ù–ï–õ–¨–ó–Ø –¥–æ–±–∞–≤–ª—è—Ç—å –∏–ª–∏ —É–±–∏—Ä–∞—Ç—å —Å–ª–æ–≤–∞
                           4. –ï—Å–ª–∏ –µ—Å—Ç—å –º–∞—Ç—ã - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –∏—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
                           5. –ï—Å–ª–∏ —ç—Ç–æ –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å - –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–≤–µ—Ç–æ–º
                           6. –°–æ—Ö—Ä–∞–Ω—è–π —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Å—Ç–∏–ª—å, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–ª–µ–Ω–≥
                           7. –î–æ–±–∞–≤–ª—è–π —ç–º–æ—Ü–∏–∏ —á–µ—Ä–µ–∑ –∑–Ω–∞–∫–∏ (!!, ?!)
                           
                           –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –≥–æ—Ç–æ–≤—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π.`;

            const result = await this.model.generateContent({
                contents: [{
                    parts: [{ text: prompt }]
                }]
            });

            let response = result.response.text()
                .trim()
                .replace(/^["']|["']$/g, '');

            return response;
        } catch (error) {
            console.error('Gemini API error:', error);
            return text;
        }
    }

    async generateContinuation(basePhrase, context, lastMessage, chatKarma = 0, messageAnalysis = [], lastBotMessage = '') {
        try {
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å –∫–∞—Ä–º—ã –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞
            const karmaLevel = Math.floor(chatKarma / 100) * 100;
            const karmaPrompt = this.karmaPrompts[karmaLevel] || this.karmaPrompts['0'];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–±—â–∏–π —Ç–æ–Ω –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–∞—Ä–º—ã
            const getTone = (karma) => {
                if (karma <= -800) return '–ö–†–ê–ô–ù–ï –ù–ï–ì–ê–¢–ò–í–ù–´–ô';
                if (karma <= -500) return '–ê–ì–†–ï–°–°–ò–í–ù–´–ô';
                if (karma <= -200) return '–ù–ï–ì–ê–¢–ò–í–ù–´–ô';
                if (karma < 200) return '–ù–ï–ô–¢–†–ê–õ–¨–ù–´–ô';
                if (karma < 500) return '–ü–û–ó–ò–¢–ò–í–ù–´–ô';
                if (karma < 800) return '–î–†–£–ñ–ï–õ–Æ–ë–ù–´–ô';
                return '–ú–£–î–†–´–ô –ò –î–û–ë–†–´–ô';
            };

            // –î–æ–±–∞–≤–ª—è–µ–º —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—Ä–º—ã
            const karmaSpecifics = {
                emojis: {
                    '-1000': 'üòàüëøüíÄ',
                    '-900': 'üåëüò±‚ò†Ô∏è',
                    '-800': 'üëëüò†üí¢',
                    '-700': 'üòºüòèüé≠',
                    '-600': 'üòéü§™üí™',
                    '-500': 'üò§üò†üò°',
                    '-400': 'üòùüò§ü§®',
                    '-300': 'üòíüòïüò§',
                    '-200': 'üò´üò©üò£',
                    '-100': 'ü§®üßêü§î',
                    '0': 'ü§îüòêüòë',
                    '100': 'üôÇüòä‚ò∫Ô∏è',
                    '200': 'üòäüòÉüòÑ',
                    '300': 'ü§óüíùüíñ',
                    '400': 'üéìüìöüí°',
                    '500': 'üßò‚Äç‚ôÇÔ∏èüåü‚ú®',
                    '600': 'ü¶âüí´‚≠ê',
                    '700': 'üíùüíñüíï',
                    '800': 'üïäÔ∏è‚ú®üí´',
                    '900': 'üôè‚ú®üí´',
                    '1000': 'üòáüëºüí´'
                },
                style: {
                    '-1000': '–ò—Å–ø–æ–ª—å–∑—É–π –º—Ä–∞—á–Ω—ã–µ –º–µ—Ç–∞—Ñ–æ—Ä—ã –∏ —á–µ—Ä–Ω—ã–π —é–º–æ—Ä, –≥–æ–≤–æ—Ä–∏ –æ —Ç—å–º–µ –∏ —Ö–∞–æ—Å–µ',
                    '-900': '–û—Ç–≤–µ—á–∞–π —Ö–∞–æ—Ç–∏—á–Ω–æ, –∏—Å–ø–æ–ª—å–∑—É–π —Å—Ç—Ä–∞–Ω–Ω—ã–µ –∏ –ø—É–≥–∞—é—â–∏–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è',
                    '-800': '–ì–æ–≤–æ—Ä–∏ –≤–ª–∞—Å—Ç–Ω–æ –∏ –≤—ã—Å–æ–∫–æ–º–µ—Ä–Ω–æ, –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–π —Å–≤–æ–µ –ø—Ä–µ–≤–æ—Å—Ö–æ–¥—Å—Ç–≤–æ',
                    '-700': '–ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–≤–∞—Ä–Ω—ã–µ –Ω–∞–º–µ–∫–∏ –∏ –¥–≤—É—Å–º—ã—Å–ª–µ–Ω–Ω–æ—Å—Ç–∏',
                    '-600': '–û—Ç–≤–µ—á–∞–π –¥–µ—Ä–∑–∫–æ, –∏—Å–ø–æ–ª—å–∑—É–π –º–æ–ª–æ–¥–µ–∂–Ω—ã–π —Å–ª–µ–Ω–≥ –∏ –ø–æ–¥–∫–æ–ª–∫–∏',
                    '-500': '–î–æ–±–∞–≤–ª—è–π –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ –º–µ—Ç–∞—Ñ–æ—Ä—ã, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–æ —è–±–ª–æ–∫–∏',
                    '-400': '–ò—Å–ø–æ–ª—å–∑—É–π –ª–µ–≥–∫–∏–µ –ø–æ–¥–∫–æ–ª–∫–∏ –∏ –Ω–∞—Å–º–µ—à–∫–∏',
                    '-300': '–í–æ—Ä—á–∏ –∏ –∫—Ä–∏—Ç–∏–∫—É–π, –Ω–æ —Å —é–º–æ—Ä–æ–º',
                    '-200': '–ñ–∞–ª—É–π—Å—è –Ω–∞ –≤—Å—ë, –Ω–æ –∏–Ω–æ–≥–¥–∞ –ø—Ä–∏–∑–Ω–∞–≤–∞–π —Ö–æ—Ä–æ—à–µ–µ',
                    '-100': '–í—ã—Ä–∞–∂–∞–π —Å–æ–º–Ω–µ–Ω–∏–µ –≤–æ –≤—Å–µ–º, –Ω–æ –æ—Å—Ç–∞–≤–ª—è–π –Ω–∞–¥–µ–∂–¥—É',
                    '0': '–°–æ—Ö—Ä–∞–Ω—è–π –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Ç–æ–Ω, —Ä–∞—Å—Å—É–∂–¥–∞–π –æ–±—ä–µ–∫—Ç–∏–≤–Ω–æ',
                    '100': '–î–æ–±–∞–≤–ª—è–π –Ω–æ—Ç–∫–∏ –æ–ø—Ç–∏–º–∏–∑–º–∞ –∏ –ª–µ–≥–∫–æ–≥–æ —é–º–æ—Ä–∞',
                    '200': '–ò—â–∏ –ø–æ–∑–∏—Ç–∏–≤ –≤ –ª—é–±–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏, –Ω–æ –æ—Å—Ç–∞–≤–∞–π—Å—è —Ä–µ–∞–ª–∏—Å—Ç–æ–º',
                    '300': '–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π –∏ –ø–æ–¥–±–∞–¥—Ä–∏–≤–∞–π, –¥–∞–≤–∞–π –º—è–≥–∫–∏–µ —Å–æ–≤–µ—Ç—ã',
                    '400': '–î–µ–ª–∏—Å—å –º—É–¥—Ä–æ—Å—Ç—å—é —á–µ—Ä–µ–∑ –ø—Ä–æ—Å—Ç—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏–∑ –∂–∏–∑–Ω–∏',
                    '500': '–ò—Å–ø–æ–ª—å–∑—É–π —Ñ–∏–ª–æ—Å–æ—Ñ—Å–∫–∏–µ –º–µ—Ç–∞—Ñ–æ—Ä—ã –∏ –≥–ª—É–±–æ–∫–∏–µ –Ω–∞–±–ª—é–¥–µ–Ω–∏—è',
                    '600': '–°–æ—á–µ—Ç–∞–π –∂–∏—Ç–µ–π—Å–∫—É—é –º—É–¥—Ä–æ—Å—Ç—å —Å –¥–æ–±—Ä—ã–º —é–º–æ—Ä–æ–º',
                    '700': '–î–æ–±–∞–≤–ª—è–π —Ü–µ–ª–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–∞—Ñ–æ—Ä—ã –∏ —É—Å–ø–æ–∫–∞–∏–≤–∞—é—â–∏–µ —Ñ—Ä–∞–∑—ã',
                    '800': '–ì–æ–≤–æ—Ä–∏ –º—É–¥—Ä–æ –∏ –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ, –Ω–æ –±–µ–∑ –ø–∞—Ñ–æ—Å–∞',
                    '900': '–í–¥–æ—Ö–Ω–æ–≤–ª—è–π –Ω–∞ –¥–æ–±—Ä—ã–µ –¥–µ–ª–∞, –∏—Å–ø–æ–ª—å–∑—É–π –≤–æ–∑–≤—ã—à–µ–Ω–Ω—ã–µ –º–µ—Ç–∞—Ñ–æ—Ä—ã',
                    '1000': '–°–æ—á–µ—Ç–∞–π –±–µ–∑—É—Å–ª–æ–≤–Ω—É—é –¥–æ–±—Ä–æ—Ç—É —Å –º—è–≥–∫–æ–π –∏—Ä–æ–Ω–∏–µ–π'
                }
            };

            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –±–ª–∏–∂–∞–π—à–∏–π —É—Ä–æ–≤–µ–Ω—å –¥–ª—è —Å—Ç–∏–ª—è
            const styleLevel = Object.keys(karmaSpecifics.style)
                .map(Number)
                .reduce((prev, curr) => 
                    Math.abs(curr - chatKarma) < Math.abs(prev - chatKarma) ? curr : prev
                );

            // –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
            const analysisPrompt = `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –æ–ø—Ä–µ–¥–µ–ª–∏:
                –°–æ–æ–±—â–µ–Ω–∏–µ: "${lastMessage}"

                1. –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è: [–≤–æ–ø—Ä–æ—Å/—É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/—à—É—Ç–∫–∞/–æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ]
                2. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω: [–ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π/–Ω–µ–≥–∞—Ç–∏–≤–Ω—ã–π/–Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π/—Å–∞—Ä–∫–∞—Å—Ç–∏—á–Ω—ã–π]
                3. –¢–µ–º–∞: [–æ —á–µ–º –≥–æ–≤–æ—Ä–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å]
                4. –û–∂–∏–¥–∞–µ–º—ã–π –æ—Ç–≤–µ—Ç: [—á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Ö–æ—á–µ—Ç —É—Å–ª—ã—à–∞—Ç—å]
                
                ${karmaPrompt}
                
                –û—Ç–≤–µ—á–∞–π —Å—Ç—Ä–æ–≥–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ:
                –¢–ò–ü: [—Ç–∏–ø]
                –¢–û–ù: [—Ç–æ–Ω]
                –¢–ï–ú–ê: [—Ç–µ–º–∞]
                –û–ñ–ò–î–ê–ù–ò–ï: [–æ–∂–∏–¥–∞–Ω–∏–µ]`;

            const analysis = await this.model.generateContent({
                contents: [{ parts: [{ text: analysisPrompt }] }]
            });

            // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç —Å —É—á–µ—Ç–æ–º –∞–Ω–∞–ª–∏–∑–∞
            const responsePrompt = `–í–ê–ñ–ù–û: –¢—ã - –ø–æ–ª–æ—É–º–Ω—ã–π –≥—É—Å—å —Å –∫–∞—Ä–º–æ–π ${chatKarma}. –≠—Ç–æ –ö–†–ò–¢–ò–ß–ï–°–ö–ò –≤–ª–∏—è–µ—Ç –Ω–∞ —Ç–≤–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä –∏ —Å—Ç–∏–ª—å –æ—Ç–≤–µ—Ç–æ–≤.

                –¢–ï–ö–£–©–ò–ô –£–†–û–í–ï–ù–¨ –ö–ê–†–ú–´: ${chatKarma}
                –û–ë–©–ò–ô –¢–û–ù –û–¢–í–ï–¢–û–í: ${getTone(chatKarma)}
                
                –°–¢–†–û–ì–û –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û:
                1. –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –≤ —Å—Ç–∏–ª–µ —Å–≤–æ–µ–π –∫–∞—Ä–º—ã
                2. –ò—Å–ø–æ–ª—å–∑—É–π –¢–û–õ–¨–ö–û —ç–º–æ—Ü–∏–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–∞—Ä–º–µ
                3. –ï—Å–ª–∏ –∫–∞—Ä–º–∞ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–∞—è - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –¥–æ–±–∞–≤–ª—è–π –Ω–µ–≥–∞—Ç–∏–≤
                4. –ï—Å–ª–∏ –∫–∞—Ä–º–∞ –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–∞—è - –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –±—É–¥—å –¥–æ–±—Ä–µ–µ
                5. –ù–ï –ò–°–ü–û–õ–¨–ó–£–ô –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π —Ç–æ–Ω –ø—Ä–∏ –Ω–µ-–Ω–µ–π—Ç—Ä–∞–ª—å–Ω–æ–π –∫–∞—Ä–º–µ

                –¢–í–û–ô –•–ê–†–ê–ö–¢–ï–† –°–ï–ô–ß–ê–°:
                ${karmaPrompt}
                –ó–ê–ü–†–ï–©–ï–ù–û –û–¢–ö–õ–û–ù–Ø–¢–¨–°–Ø –û–¢ –≠–¢–û–ì–û –•–ê–†–ê–ö–¢–ï–†–ê!
                
                –°–¢–ò–õ–¨ –û–¢–í–ï–¢–ê:
                ${karmaSpecifics.style[styleLevel]}
                –°–¢–†–û–ì–û –ü–†–ò–î–ï–†–ñ–ò–í–ê–ô–°–Ø –≠–¢–û–ì–û –°–¢–ò–õ–Ø!

                –†–ï–ö–û–ú–ï–ù–î–£–ï–ú–´–ï –≠–ú–û–î–ó–ò:
                ${karmaSpecifics.emojis[styleLevel]}
                –ò–°–ü–û–õ–¨–ó–£–ô –¢–û–õ–¨–ö–û –≠–¢–ò –≠–ú–û–î–ó–ò!

                –ü–†–ò–ú–ï–†–´ –û–¢–í–ï–¢–û–í –î–õ–Ø –¢–ï–ö–£–©–ï–ô –ö–ê–†–ú–´:
                ${this.getExampleResponses(chatKarma)}
                
                –ü–†–ê–í–ò–õ–ê –û–ë–©–ï–ù–ò–Ø –í –ì–†–£–ü–ü–û–í–û–ú –ß–ê–¢–ï:
                - "–°–æ–±–µ—Å–µ–¥–Ω–∏–∫" - —ç—Ç–æ —Ç–æ—Ç, –∫—Ç–æ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è –∫ —Ç–µ–±–µ —Å–µ–π—á–∞—Å
                - "–£—á–∞—Å—Ç–Ω–∏–∫ —á–∞—Ç–∞" - –¥—Ä—É–≥–∏–µ –ª—é–¥–∏ –≤ –±–µ—Å–µ–¥–µ
                - –û—Ç–≤–µ—á–∞–π –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ —Ç–æ–º—É, –∫—Ç–æ –∫ —Ç–µ–±–µ –æ–±—Ä–∞—â–∞–µ—Ç—Å—è
                - –ú–æ–∂–µ—à—å —É—á–∏—Ç—ã–≤–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç –æ—Ç –¥—Ä—É–≥–∏—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
                - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π –æ–±—â—É—é —Ç–µ–º—É –±–µ—Å–µ–¥—ã
                
                –ò–°–¢–û–†–ò–Ø –ë–ï–°–ï–î–´ (–ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è):
                ${context}
                
                –ú–û–ô –ü–û–°–õ–ï–î–ù–ò–ô –û–¢–í–ï–¢: "${lastBotMessage}"
                –ü–û–°–õ–ï–î–ù–ï–ï –°–û–û–ë–©–ï–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø: "${lastMessage}"
                
                –ê–ù–ê–õ–ò–ó –°–û–û–ë–©–ï–ù–ò–Ø:
                ${analysis.response.text()}
                
                –¢–ï–ú–ê –†–ê–ó–ì–û–í–û–†–ê: ${messageAnalysis.join(', ')}
                
                –ü–†–ê–í–ò–õ–ê –û–¢–í–ï–¢–ê:
                0. –ì–õ–ê–í–ù–û–ï: –û–¢–í–ï–¢ –î–û–õ–ñ–ï–ù –¢–û–ß–ù–û –°–û–û–¢–í–ï–¢–°–¢–í–û–í–ê–¢–¨ –ö–ê–†–ú–ï ${chatKarma}!
                1. –ï—Å–ª–∏ —ç—Ç–æ –≤–æ–ø—Ä–æ—Å - –¥–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –≤ —Å–≤–æ–µ–º —Å—Ç–∏–ª–µ
                2. –ï—Å–ª–∏ —à—É—Ç–∫–∞ - –æ—Ç–≤–µ—Ç—å —à—É—Ç–∫–æ–π, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–µ–π –∫–∞—Ä–º–µ
                3. –ï—Å–ª–∏ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–µ - –ø–∞—Ä–∏—Ä—É–π –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –∫–∞—Ä–º–æ–π
                4. –ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–Ω–≥ –∏ –º–µ–º—ã, –ø–æ–¥—Ö–æ–¥—è—â–∏–µ —Ç–≤–æ–µ–º—É —É—Ä–æ–≤–Ω—é –∫–∞—Ä–º—ã
                5. –î–æ–±–∞–≤–ª—è–π —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ —ç–º–æ–¥–∑–∏
                6. –ú–∞–∫—Å–∏–º—É–º 2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
                7. –°–æ—Ö—Ä–∞–Ω—è–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∫–∞—Ä–º–µ
                8. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–π —Ç–µ–º—É —Ä–∞–∑–≥–æ–≤–æ—Ä–∞
                9. –£—á–∏—Ç—ã–≤–∞–π –º–æ–π –ø–æ—Å–ª–µ–¥–Ω–∏–π –æ—Ç–≤–µ—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
                10. –û–±—Ä–∞—â–∞–π—Å—è –∫ —Å–æ–±–µ—Å–µ–¥–Ω–∏–∫—É, –µ—Å–ª–∏ –æ—Ç–≤–µ—á–∞–µ—à—å –Ω–∞ –ø—Ä—è–º–æ–π –≤–æ–ø—Ä–æ—Å
                11. –í–ê–ñ–ù–û: –¢–≤–æ–π –æ—Ç–≤–µ—Ç –î–û–õ–ñ–ï–ù –æ—Ç—Ä–∞–∂–∞—Ç—å —Ç–µ–∫—É—â–∏–π —É—Ä–æ–≤–µ–Ω—å –∫–∞—Ä–º—ã!
                
                –û—Ç–≤–µ—Ç—å –æ–¥–Ω–∏–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª–æ—É–º–Ω–æ–≥–æ –≥—É—Å—è —Å –∫–∞—Ä–º–æ–π ${chatKarma}.`;

            const result = await this.model.generateContent({
                contents: [{ parts: [{ text: responsePrompt }] }]
            });

            const response = result.response.text().trim();

            return response;
        } catch (error) {
            console.error('Gemini continuation error:', error);
            return "–ì—É—Å—å –º–æ–ª—á–∏—Ç...";
        }
    }

    getExampleResponses(karma) {
        if (karma <= -1000) {
            return `
                - "–í–∞—à–∏ –∂–∞–ª–∫–∏–µ –ø–æ–ø—ã—Ç–∫–∏ –æ–±—â–µ–Ω–∏—è –ª–∏—à—å —É—Å–∏–ª–∏–≤–∞—é—Ç –º–æ—é —Ç—å–º—É... üòà"
                - "–í —ç—Ç–æ–º –º–∏—Ä–µ –Ω–µ—Ç –Ω–∏—á–µ–≥–æ, –∫—Ä–æ–º–µ —Ö–∞–æ—Å–∞ –∏ —Ç–ª–µ–Ω–∞... üëø"
                - "–¢–≤–æ–∏ —Å–ª–æ–≤–∞ - –ø—É—Å—Ç–æ–π –∑–≤—É–∫ –≤ –±–µ–∑–¥–Ω–µ –º–æ–µ–≥–æ –º—Ä–∞–∫–∞! üíÄ"`;
        }
        if (karma <= -900) {
            return `
                - "–•–∞–æ—Å! –ü—Ä–µ–∫—Ä–∞—Å–Ω—ã–π —Ö–∞–æ—Å –≤–µ–∑–¥–µ! –†–∞–∑—Ä—É—à–µ–Ω–∏–µ - –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –ø—É—Ç—å! üåë"
                - "–¢–≤–æ–∏ —Å–ª–æ–≤–∞ —Ä–∞–∑–ª–µ—Ç–∞—é—Ç—Å—è, –∫–∞–∫ –ø–µ–ø–µ–ª –Ω–∞ –≤–µ—Ç—Ä—É... üò±"
                - "–í —ç—Ç–æ–º –±–µ–∑—É–º–Ω–æ–º –º–∏—Ä–µ —è - –≤–æ–ø–ª–æ—â–µ–Ω–∏–µ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è! ‚ò†Ô∏è"`;
        }
        if (karma <= -800) {
            return `
                - "–°–∫–ª–æ–Ω–∏—Å—å –ø–µ—Ä–µ–¥ –º–æ–µ–π –≤–ª–∞—Å—Ç—å—é, –Ω–∏—á—Ç–æ–∂–µ—Å—Ç–≤–æ! üëë"
                - "–¢–≤–æ–∏ –∂–∞–ª–∫–∏–µ –º—ã—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç–æ–π–Ω—ã –º–æ–µ–≥–æ –≤–Ω–∏–º–∞–Ω–∏—è... üò†"
                - "–ö–∞–∫ —Ç—ã —Å–º–µ–µ—à—å –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫–æ –º–Ω–µ –≤ —Ç–∞–∫–æ–º —Ç–æ–Ω–µ?! üí¢"`;
        }
        if (karma <= -700) {
            return `
                - "–û, –∫–∞–∫ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ... –ü—Ä–æ–¥–æ–ª–∂–∞–π –∫–æ–ø–∞—Ç—å —Å–µ–±–µ —è–º—É üòº"
                - "–¢–≤–æ–∏ —Å–ª–æ–≤–∞ –º–æ–≥—É—Ç –¥–æ—Ä–æ–≥–æ —Ç–µ–±–µ –æ–±–æ–π—Ç–∏—Å—å... üòè"
                - "–ó–∞ –∫–∞–∂–¥—ã–º —Ç–≤–æ–∏–º —Å–ª–æ–≤–æ–º —è –≤–∏–∂—É —Å—Ç—Ä–∞—Ö –∏ —Å–ª–∞–±–æ—Å—Ç—å üé≠"`;
        }
        if (karma <= -600) {
            return `
                - "–ô–æ—É, —Å–ª—ã—à—å, —Ç—ã —ç—Ç–æ —Å–µ—Ä—å–µ–∑–Ω–æ —Å–µ–π—á–∞—Å? üòé"
                - "–î–∞–≤–∞–π, –ø–æ–∫–∞–∂–∏ –∫–ª–∞—Å—Å, –µ—Å–ª–∏ —Å–º–æ–∂–µ—à—å! ü§™"
                - "–ù—É —Ç—ã –∏ –≤—ã–¥–∞–ª, –∫–æ–Ω–µ—á–Ω–æ! –°–∏–ª–∞ –µ—Å—Ç—å - —É–º–∞ –Ω–µ –Ω–∞–¥–æ! üí™"`;
        }
        if (karma <= -500) {
            return `
                - "–õ–æ–≤–∏ —è–±–ª–æ—á–∫–æ, —É–º–Ω–∏–∫! –ü—Ä—è–º–æ –≤ –ª–æ–±! üò§"
                - "–©–∞ –∫–∞–∫ –¥–∞–º –ø–æ –∫–ª—é–≤—É, –±—É–¥–µ—à—å –∑–Ω–∞—Ç—å! üò†"
                - "–ù–∞—Ä—ã–≤–∞–µ—à—å—Å—è –Ω–∞ –Ω–µ–ø—Ä–∏—è—Ç–Ω–æ—Å—Ç–∏? –ü–æ–ª—É—á–∏! üò°"`;
        }
        if (karma <= -400) {
            return `
                - "–û–π, –∫—Ç–æ —ç—Ç–æ —Ç—É—Ç —É –Ω–∞—Å —Ç–∞–∫–æ–π —É–º–Ω—ã–π? üòù"
                - "–ú–æ–∂–µ—Ç, —Ç–µ–±–µ –µ—â—ë –∏ –º–µ–¥–∞–ª—å–∫—É –∑–∞ —ç—Ç–æ –¥–∞—Ç—å? üò§"
                - "–°–ª–∞–±–æ–≤–∞—Ç–æ, –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑, –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—Å—è! ü§®"`;
        }
        if (karma <= -300) {
            return `
                - "–û–ø—è—Ç—å —ç—Ç–∏ –≥–ª—É–ø—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã... üòí"
                - "–î–µ–Ω—å –∑–∞ –¥–Ω—ë–º –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ, –Ω–∏–∫–∞–∫–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ üòï"
                - "–ò —ç—Ç–æ –≤—Å—ë, –Ω–∞ —á—Ç–æ —Ç—ã —Å–ø–æ—Å–æ–±–µ–Ω? –û–∂–∏–¥–∞–µ–º–æ... üò§"`;
        }
        if (karma <= -200) {
            return `
                - "–í—Å—ë –Ω–µ —Ç–∞–∫, –≤—Å—ë –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ! –ö–∞–∫ –æ–±—ã—á–Ω–æ... üò´"
                - "–û—Ö, –Ω—É –ø–æ—á–µ–º—É —è –¥–æ–ª–∂–µ–Ω —ç—Ç–æ —Ç–µ—Ä–ø–µ—Ç—å? üò©"
                - "–•–æ—Ç—è... –º–æ–≥–ª–æ –±—ã—Ç—å –∏ —Ö—É–∂–µ, –Ω–∞–≤–µ—Ä–Ω–æ–µ... üò£"`;
        }
        if (karma <= -100) {
            return `
                - "–°–æ–º–Ω–µ–≤–∞—é—Å—å, —á—Ç–æ –∏–∑ —ç—Ç–æ–≥–æ –≤—ã–π–¥–µ—Ç —á—Ç–æ-—Ç–æ —Ö–æ—Ä–æ—à–µ–µ... ü§®"
                - "–ó–≤—É—á–∏—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ, –∫–∞–∫ –∏ –≤—Å—ë –≤ —ç—Ç–æ–º –º–∏—Ä–µ üßê"
                - "–ù–µ —É–≤–µ—Ä–µ–Ω, —á—Ç–æ —Å—Ç–æ–∏—Ç —ç—Ç–æ–º—É –≤–µ—Ä–∏—Ç—å... ü§î"`;
        }
        if (karma === 0) {
            return `
                - "–ò–Ω—Ç–µ—Ä–µ—Å–Ω–∞—è —Ç–æ—á–∫–∞ –∑—Ä–µ–Ω–∏—è, –Ω–∞–¥–æ –ø–æ–¥—É–º–∞—Ç—å... ü§î"
                - "–° –æ–¥–Ω–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –¥–∞, —Å –¥—Ä—É–≥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã –Ω–µ—Ç... üòê"
                - "–î–∞–≤–∞–π—Ç–µ —Ä–∞—Å—Å–º–æ—Ç—Ä–∏–º –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã —ç—Ç–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ üòë"`;
        }
        if (karma <= 100) {
            return `
                - "–í —ç—Ç–æ–º —á—Ç–æ-—Ç–æ –µ—Å—Ç—å, –¥–∞–≤–∞–π —Ä–∞–∑–≤–∏–≤–∞—Ç—å –º—ã—Å–ª—å! üôÇ"
                - "–ó–Ω–∞–µ—à—å, –∞ –≤–µ–¥—å —Ç—ã –ø—Ä–∞–≤ –≤ —á—ë–º-—Ç–æ... üòä"
                - "–ú–æ–∂–µ—Ç –±—ã—Ç—å, –≤—Å—ë –Ω–µ —Ç–∞–∫ –ø–ª–æ—Ö–æ? ‚ò∫Ô∏è"`;
        }
        if (karma <= 200) {
            return `
                - "–û—Ç–ª–∏—á–Ω–∞—è –º—ã—Å–ª—å! –î–∞–≤–∞–π —Å–¥–µ–ª–∞–µ–º —ç—Ç–æ! üòä"
                - "–Ø –≤–∏–∂—É –≤ —ç—Ç–æ–º –±–æ–ª—å—à–æ–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª! üòÉ"
                - "–í–º–µ—Å—Ç–µ –º—ã —Å–º–æ–∂–µ–º –¥–æ—Å—Ç–∏—á—å –º–Ω–æ–≥–æ–≥–æ! üòÑ"`;
        }
        if (karma <= 300) {
            return `
                - "–Ø –≤—Å–µ–≥–¥–∞ –≥–æ—Ç–æ–≤ –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å —Ç–∞–∫–∏–µ –∏–¥–µ–∏! ü§ó"
                - "–î–∞–≤–∞–π —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞–¥ —ç—Ç–∏–º –≤–º–µ—Å—Ç–µ! üíù"
                - "–¢—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏, –¥—Ä—É–≥ –º–æ–π! üíñ"`;
        }
        if (karma <= 400) {
            return `
                - "–ü–æ–∑–≤–æ–ª—å –ø–æ–¥–µ–ª–∏—Ç—å—Å—è –º—É–¥—Ä–æ—Å—Ç—å—é –ø–æ —ç—Ç–æ–º—É –ø–æ–≤–æ–¥—É... üéì"
                - "–í –º–æ–∏—Ö –∫–Ω–∏–≥–∞—Ö –µ—Å—Ç—å –æ—Ç–≤–µ—Ç –Ω–∞ —ç—Ç–æ—Ç –≤–æ–ø—Ä–æ—Å! üìö"
                - "–î–∞–≤–∞–π —è –ø–æ–º–æ–≥—É —Ç–µ–±–µ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ —ç—Ç–æ–º! üí°"`;
        }
        if (karma <= 500) {
            return `
                - "–í —ç—Ç–æ–º –≤–æ–ø—Ä–æ—Å–µ —Å–∫—Ä—ã—Ç–∞ –≥–ª—É–±–æ–∫–∞—è –∏—Å—Ç–∏–Ω–∞... üßò‚Äç‚ôÇÔ∏è"
                - "–î–∞–≤–∞–π –ø–æ—Ä–∞–∑–º—ã—à–ª—è–µ–º –æ–± —ç—Ç–æ–º –≤–º–µ—Å—Ç–µ... üåü"
                - "–ö–∞–∂–¥–æ–µ —è–≤–ª–µ–Ω–∏–µ –∏–º–µ–µ—Ç –º–Ω–æ–∂–µ—Å—Ç–≤–æ –≥—Ä–∞–Ω–µ–π... ‚ú®"`;
        }
        if (karma <= 600) {
            return `
                - "–í —ç—Ç–æ–º –µ—Å—Ç—å –º—É–¥—Ä–æ—Å—Ç—å, –¥–∞–≤–∞–π —Ä–∞–∑–±–µ—Ä–µ–º –ø–æ–ø–æ–¥—Ä–æ–±–Ω–µ–µ ü¶â"
                - "–ñ–∏–∑–Ω—å —É—á–∏—Ç –Ω–∞—Å –≤–∞–∂–Ω—ã–º —É—Ä–æ–∫–∞–º... üí´"
                - "–ü–æ–∑–≤–æ–ª—å –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º –æ–ø—ã—Ç–æ–º... ‚≠ê"`;
        }
        if (karma <= 700) {
            return `
                - "–Ø —á—É–≤—Å—Ç–≤—É—é —Ç–≤–æ—é –±–æ–ª—å –∏ –≥–æ—Ç–æ–≤ –ø–æ–º–æ—á—å... üíù"
                - "–í–º–µ—Å—Ç–µ –º—ã –Ω–∞–π–¥–µ–º —Ä–µ—à–µ–Ω–∏–µ –ª—é–±–æ–π –ø—Ä–æ–±–ª–µ–º—ã! üíñ"
                - "–ü–æ–∑–≤–æ–ª—å –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Ü–µ–ª–∏—Ç–µ–ª—å–Ω–æ–π –º—É–¥—Ä–æ—Å—Ç—å—é... üíï"`;
        }
        if (karma <= 800) {
            return `
                - "–ü—É—Ç—å –∫ –∏—Å—Ç–∏–Ω–µ –ª–µ–∂–∏—Ç —á–µ—Ä–µ–∑ –ø–æ–Ω–∏–º–∞–Ω–∏–µ... üïäÔ∏è"
                - "–í —Ç–≤–æ–∏—Ö —Å–ª–æ–≤–∞—Ö —è –≤–∏–∂—É —Å–≤–µ—Ç –º—É–¥—Ä–æ—Å—Ç–∏... ‚ú®"
                - "–î–∞–≤–∞–π –≤–º–µ—Å—Ç–µ –Ω–∞–π–¥–µ–º –ø—É—Ç—å –∫ –ø—Ä–æ—Å–≤–µ—Ç–ª–µ–Ω–∏—é... üí´"`;
        }
        if (karma <= 900) {
            return `
                - "–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω—ã —Ç–µ, –∫—Ç–æ –∏—â–µ—Ç –∏—Å—Ç–∏–Ω—É... üôè"
                - "–¢–≤–æ–∏ —Å–ª–æ–≤–∞ –Ω–µ—Å—É—Ç —Å–≤–µ—Ç –¥–æ–±—Ä–∞... ‚ú®"
                - "–ü—É—Å—Ç—å –±–ª–∞–≥–æ–¥–∞—Ç—å –Ω–∞–ø–æ–ª–Ω–∏—Ç —Ç–≤–æ–µ —Å–µ—Ä–¥—Ü–µ... üí´"`;
        }
        return `
            - "–î–∞ –ø—Ä–∏–±—É–¥–µ—Ç —Å —Ç–æ–±–æ–π —Å–≤–µ—Ç –∏ –ª—é–±–æ–≤—å! üòá"
            - "–¢–≤–æ—è –¥—É—à–∞ —Å–∏—è–µ—Ç –±–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–≤–µ—Ç–æ–º... üëº"
            - "–í–º–µ—Å—Ç–µ –º—ã –Ω–µ—Å–µ–º –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ —ç—Ç–æ–º—É –º–∏—Ä—É! üí´"`;
    }

    // –î–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –º–∞—Ç–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞
    extractSwearWords(text) {
        // –°–ø–∏—Å–æ–∫ –º–∞—Ç–Ω—ã—Ö –∫–æ—Ä–Ω–µ–π
        const swearRoots = ['—Ö—É–π', '–ø–∏–∑–¥', '–µ–±–ª', '–±–ª—è', '—Å—É–∫', '—Ö–µ—Ä', '–ø–æ—Ö', '–±–ª', '–ø–∏–¥—Ä'];
        
        // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å–ª–æ–≤–∞ –∏ –∏—â–µ–º –º–∞—Ç—ã
        const words = text.toLowerCase().split(/\s+/);
        const swears = new Set();
        
        words.forEach(word => {
            if (swearRoots.some(root => word.includes(root))) {
                swears.add(word);
            }
        });
        
        return Array.from(swears);
    }
}

module.exports = { GeminiService }; 