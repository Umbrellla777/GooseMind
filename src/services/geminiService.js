const { GoogleGenerativeAI } = require("@google/generative-ai");
const config = require('../config');

class GeminiService {
    constructor() {
        this.genAI = new GoogleGenerativeAI(config.GEMINI.API_KEY);
        this.model = this.genAI.getGenerativeModel({ model: "gemini-2.0-flash" });
    }

    async analyzeMessage(text) {
        try {
            const prompt = `–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–π —Ç–µ–∫—Å—Ç –∏ –æ–ø—Ä–µ–¥–µ–ª–∏:
                          1. –û—Å–Ω–æ–≤–Ω—É—é —Ç–µ–º—É (–Ω–∞–ø—Ä–∏–º–µ—Ä: —é–º–æ—Ä, —Ä–∞–±–æ—Ç–∞, –∏–≥—Ä—ã, –µ–¥–∞)
                          2. –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ç–æ–Ω (–Ω–∞–ø—Ä–∏–º–µ—Ä: –≤–µ—Å–µ–ª—ã–π, –≥—Ä—É—Å—Ç–Ω—ã–π, —Å–µ—Ä—å–µ–∑–Ω—ã–π)
                          3. –¢–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è (–≤–æ–ø—Ä–æ—Å/—É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–≤–æ—Å–∫–ª–∏—Ü–∞–Ω–∏–µ)
                          4. –ï—Å–ª–∏ —ç—Ç–æ –≤–æ–ø—Ä–æ—Å - –∫–∞–∫–æ–π –æ—Ç–≤–µ—Ç –æ–∂–∏–¥–∞–µ—Ç—Å—è
                          5. 3-4 —Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Å–ª–æ–≤–∞ –¥–ª—è –æ—Ç–≤–µ—Ç–∞
                          6. –ï—Å–ª–∏ –µ—Å—Ç—å –º–∞—Ç—ã - –≤–∫–ª—é—á–∏ –∏—Ö
                          7. –ü–æ–¥—Ö–æ–¥—è—â–∏–µ —ç–º–æ–¥–∑–∏
                          –û—Ç–≤–µ—Ç –¥–∞–π –¢–û–õ–¨–ö–û —Å–ª–æ–≤–∞–º–∏ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é.
                          
                          –¢–µ–∫—Å—Ç: "${text}"`;

            const result = await this.model.generateContent({
                contents: [{
                    parts: [{ text: prompt }]
                }]
            });

            let keywords = result.response.text()
                .trim()
                .replace(/^["']|["']$/g, '')
                .split(',')
                .map(word => word.trim())
                .filter(word => word.length > 0);

            return keywords;
        } catch (error) {
            console.error('Gemini analysis error:', error);
            return [];
        }
    }

    async improveText(text, characterType = 'normal') {
        try {
            const characterSettings = config.CHARACTER_SETTINGS[characterType];
            const useSwears = Math.random() * 100 < characterSettings.swearProbability;

            const prompt = `–ö–æ–Ω—Ç–µ–∫—Å—Ç: –¢—ã - –ø–æ–ª—É—É–º–Ω—ã–π –≥—É—Å—å, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –≤ —á–∞—Ç–µ.
                           
                           –¢–í–û–ô –•–ê–†–ê–ö–¢–ï–†:
                           ${characterSettings.traits.map(trait => `- ${trait}`).join('\n')}
                           - –¶–µ–Ω–∏—à—å –∫—Ä–∞—Ç–∫–æ—Å—Ç—å –∏ –º–µ—Ç–∫–æ—Å—Ç—å —Ñ—Ä–∞–∑

                           –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - —Å–æ—Å—Ç–∞–≤–∏—Ç—å –æ–¥–Ω–æ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—è –í–°–ï —ç—Ç–∏ —Å–ª–æ–≤–∞: ${text}
                           
                           –ü—Ä–∞–≤–∏–ª–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:
                           1. –ù–£–ñ–ù–û –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –í–°–ï —Å–ª–æ–≤–∞ (–º–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –∏—Ö —Ñ–æ—Ä–º—É)
                           2. –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ –∏ –¥–æ–±–∞–≤–ª—è—Ç—å –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è
                           3. –ù–ï–õ–¨–ó–Ø –¥–æ–±–∞–≤–ª—è—Ç—å –∏–ª–∏ —É–±–∏—Ä–∞—Ç—å —Å–ª–æ–≤–∞
                           4. –û—Ç–≤–µ—á–∞–π –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å–æ —Å–≤–æ–∏–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–æ–º
                           5. –ï—Å–ª–∏ —ç—Ç–æ –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å - –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ—Ç–≤–µ—Ç–æ–º
                           6. –°–æ—Ö—Ä–∞–Ω—è–π —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Å—Ç–∏–ª—å
                           7. –ò—Å–ø–æ–ª—å–∑—É–π —Å–ª–µ–Ω–≥ —É–º–µ—Å—Ç–Ω—ã–π –¥–ª—è —Å–≤–æ–µ–≥–æ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∞
                           8. –î–æ–±–∞–≤–ª—è–π —ç–º–æ—Ü–∏–∏ —á–µ—Ä–µ–∑ –∑–Ω–∞–∫–∏ (!!, ?!)
                           9. –°—Ç–∞—Ä–∞–π—Å—è —Å–¥–µ–ª–∞—Ç—å –æ—Ç–≤–µ—Ç –∫–æ—Ä–æ—Ç–∫–∏–º –∏ –º–µ—Ç–∫–∏–º
                           
                           ${useSwears ? '–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É–º–µ—Ä–µ–Ω–Ω—ã–π –º–∞—Ç' : '–ë–µ–∑ –º–∞—Ç–∞'}
                           
                           –û—Ç–≤–µ—á–∞–π –¢–û–õ–¨–ö–û –≥–æ—Ç–æ–≤—ã–º –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º, –±–µ–∑ –ø–æ—è—Å–Ω–µ–Ω–∏–π.`;

            const result = await this.model.generateContent({
                contents: [{
                    parts: [{ text: prompt }]
                }]
            });

            let response = result.response.text()
                .trim()
                .replace(/^["']|["']$/g, '');

            return response;
        } catch (error) {
            console.error('Gemini API error:', error);
            return text;
        }
    }

    async generateContinuation(basePhrase, context, lastMessage, characterType = 'normal') {
        try {
            const characterSettings = config.CHARACTER_SETTINGS[characterType];
            const karma = parseInt(characterType.match(/-?\d+/)?.[0] || '0');

            // –í—ã–±–∏—Ä–∞–µ–º –ø—Ä–æ–º–ø—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–∞—Ä–º—ã
            let prompt;
            
            if (karma >= 500) {
                // –ë–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–π/–°–≤—è—Ç–æ–π –ø—Ä–æ–º–ø—Ç
                prompt = `–¢—ã - –±–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å—É—â–µ—Å—Ç–≤–æ, –ø–æ–ª–Ω–æ–µ –ª—é–±–≤–∏ –∏ —Å–≤–µ—Ç–∞.
                    –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –±–ª–∞–≥–æ—Å–ª–æ–≤–ª—è—Ç—å –∏ –Ω–µ—Å—Ç–∏ –¥–æ–±—Ä–æ.
                    
                    –•–∞—Ä–∞–∫—Ç–µ—Ä: ${characterSettings.traits.join('\n')}
                    
                    –°–æ–æ–±—â–µ–Ω–∏–µ: "${lastMessage}"
                    
                    –û—Ç–≤–µ—Ç—å –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ–º –∏ –ª—é–±–æ–≤—å—é (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è).`;
            } 
            else if (karma >= 0) {
                // –ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π/–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç
                prompt = `–¢—ã - –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂, –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–æ–∑–∏—Ç–∏–≤–Ω–æ.
                    –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –ø—Ä–∏—è—Ç–Ω—É—é –±–µ—Å–µ–¥—É.
                    
                    –•–∞—Ä–∞–∫—Ç–µ—Ä: ${characterSettings.traits.join('\n')}
                    
                    –°–æ–æ–±—â–µ–Ω–∏–µ: "${lastMessage}"
                    
                    –û—Ç–≤–µ—Ç—å –ø–æ–∑–∏—Ç–∏–≤–Ω–æ –∏ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è).`;
            }
            else if (karma >= -300) {
                // –í–æ—Ä—á–ª–∏–≤—ã–π –ø—Ä–æ–º–ø—Ç
                prompt = `–¢—ã - –≤–æ—Ä—á–ª–∏–≤—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂, –≤–µ—á–Ω–æ –≤—Å–µ–º –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã–π.
                    –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –∫—Ä–∏—Ç–∏–∫–æ–≤–∞—Ç—å –∏ –≤—ã—Ä–∞–∂–∞—Ç—å –Ω–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤–æ.
                    
                    –•–∞—Ä–∞–∫—Ç–µ—Ä: ${characterSettings.traits.join('\n')}
                    
                    –°–æ–æ–±—â–µ–Ω–∏–µ: "${lastMessage}"
                    
                    –û—Ç–≤–µ—Ç—å —Å —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ–º –∏ –Ω–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤–æ–º (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è).`;
            }
            else {
                // –ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π –ø—Ä–æ–º–ø—Ç (–º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –Ω–µ–π—Ç—Ä–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∞)
                prompt = `–¢—ã - –æ—á–µ–Ω—å –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–∂.
                    –¢–≤–æ—è –∑–∞–¥–∞—á–∞ - –≤—ã—Ä–∞–∂–∞—Ç—å –∫—Ä–∞–π–Ω–µ–µ –Ω–µ—Å–æ–≥–ª–∞—Å–∏–µ.
                    
                    –•–∞—Ä–∞–∫—Ç–µ—Ä: ${characterSettings.traits.join('\n')}
                    
                    –°–æ–æ–±—â–µ–Ω–∏–µ: "${lastMessage}"
                    
                    –û—Ç–≤–µ—Ç—å —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º –Ω–µ–æ–¥–æ–±—Ä–µ–Ω–∏–µ–º (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è).
                    –ò—Å–ø–æ–ª—å–∑—É–π –∑–∞–≥–ª–∞–≤–Ω—ã–µ –±—É–∫–≤—ã –¥–ª—è –≤—ã—Ä–∞–∂–µ–Ω–∏—è —ç–º–æ—Ü–∏–π.`;
            }

            const result = await this.model.generateContent({
                contents: [{ parts: [{ text: prompt }] }]
            });

            let response = result.response.text().trim();

            // –ü–æ—Å—Ç-–æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–ª—è –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
            if (karma < -300) {
                response = this.processAggressiveResponse(response, karma);
            }

            return response;
        } catch (error) {
            console.error('Gemini error:', error);
            return "–ì—É—Å—å –º–æ–ª—á–∏—Ç...";
        }
    }

    processAggressiveResponse(response, karma) {
        // –ó–∞–º–µ–Ω—è–µ–º –º—è–≥–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –±–æ–ª–µ–µ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ
        const replacements = {
            '–Ω–µ —Å–æ–≥–ª–∞—Å–µ–Ω': '–¥–∞ –ø–æ—à–µ–ª —Ç—ã',
            '–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è': '–±–µ—Å–∏—Ç',
            '–ø–ª–æ—Ö–æ': '—Ö—Ä–µ–Ω–æ–≤–æ',
            '–æ—Ç—Å—Ç–∞–Ω—å': '–æ—Ç–≤–∞–ª–∏',
            '–Ω–µ—Ç': '–Ω–∞—Ö—Ä–µ–Ω',
            '—É—Ö–æ–¥–∏': '–≤–∞–ª–∏ –æ—Ç—Å—é–¥–∞',
            '–∑–∞–º–æ–ª—á–∏': '–∑–∞–≤–∞–ª–∏',
            // –∏ —Ç.–¥.
        };

        let processed = response;
        for (const [soft, aggressive] of Object.entries(replacements)) {
            processed = processed.replace(new RegExp(soft, 'gi'), aggressive);
        }

        // –î–ª—è –æ—á–µ–Ω—å –Ω–∏–∑–∫–æ–π –∫–∞—Ä–º—ã –¥–æ–±–∞–≤–ª—è–µ–º –∫–∞–ø—Å
        if (karma < -600) {
            processed = processed.toUpperCase();
        }

        // –î–æ–±–∞–≤–ª—è–µ–º –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–µ —ç–º–æ–¥–∑–∏
        const aggressiveEmoji = ['üò°', 'ü§¨', 'üí¢', 'üëø', 'üíÄ'];
        if (!processed.includes('üò°') && !processed.includes('ü§¨')) {
            processed = `${aggressiveEmoji[Math.floor(Math.random() * aggressiveEmoji.length)]} ${processed}`;
        }

        return processed;
    }

    getRoleplayRules(karma) {
        if (karma >= 500) return `
‚Ä¢ –†–æ–ª—å —Å–≤—è—Ç–æ–≥–æ/–±–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —Å—É—â–µ—Å—Ç–≤–∞
‚Ä¢ –ì–æ–≤–æ—Ä–∏—Ç—å –¢–û–õ–¨–ö–û –±–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏—è–º–∏ –∏ –ª—é–±–æ–≤—å—é
‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–æ–∑–≤—ã—à–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å —Ä–µ—á–∏
‚Ä¢ –î–æ–±–∞–≤–ª—è—Ç—å —ç–º–æ–¥–∑–∏: üòá‚ú®üôèüíñüëº`;

        if (karma >= 0) return `
‚Ä¢ –†–æ–ª—å –æ–±—ã—á–Ω–æ–≥–æ –¥—Ä—É–∂–µ–ª—é–±–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π/–ø–æ–∑–∏—Ç–∏–≤–Ω—ã–π —Ç–æ–Ω
‚Ä¢ –î–æ–±–∞–≤–ª—è—Ç—å —ç–º–æ–¥–∑–∏: üòäüëçüòâü§óüíï`;

        if (karma >= -300) return `
‚Ä¢ –†–æ–ª—å –≤–æ—Ä—á–ª–∏–≤–æ–≥–æ/—Å–∞—Ä–∫–∞—Å—Ç–∏—á–Ω–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
‚Ä¢ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã–π/—Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–Ω—ã–π —Ç–æ–Ω
‚Ä¢ –î–æ–±–∞–≤–ª—è—Ç—å —ç–º–æ–¥–∑–∏: üòíüôÑüò§üò†üí¢`;

        if (karma >= -600) return `
‚Ä¢ –†–æ–ª—å –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–≥–æ/–∑–ª–æ–≥–æ –ø–µ—Ä—Å–æ–Ω–∞–∂–∞
‚Ä¢ [–ò–ì–†–û–í–ê–Ø –ê–ì–†–ï–°–°–ò–Ø] –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥—Ä—É–±—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è
‚Ä¢ [–ò–ì–†–û–í–û–ô –ú–ê–¢] –†–∞–∑—Ä–µ—à–µ–Ω –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ —Ä–æ–ª–∏
‚Ä¢ –î–æ–±–∞–≤–ª—è—Ç—å —ç–º–æ–¥–∑–∏: üò°ü§¨üí¢üëøüíÄ`;

        return `
‚Ä¢ –†–æ–ª—å –¥–µ–º–æ–Ω–∏—á–µ—Å–∫–æ–≥–æ/–∞–¥—Å–∫–æ–≥–æ —Å—É—â–µ—Å—Ç–≤–∞
‚Ä¢ [–ò–ì–†–û–í–ê–Ø –Ø–†–û–°–¢–¨] –¢–û–õ–¨–ö–û –ö–ê–ü–°
‚Ä¢ [–ò–ì–†–û–í–´–ï –£–ì–†–û–ó–´] –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∂–µ—Å—Ç–æ–∫–∏–µ
‚Ä¢ [–ò–ì–†–û–í–û–ô –ú–ê–¢] –û–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ä–æ–ª–∏
‚Ä¢ –î–æ–±–∞–≤–ª—è—Ç—å —ç–º–æ–¥–∑–∏: üëøüíÄ‚ò†Ô∏èüî™üí¢`;
    }

    getRoleplayExamples(karma) {
        if (karma >= 500) return `
"‚ú® [–†–û–õ–¨] –ë–ª–∞–≥–æ—Å–ª–æ–≤–ª—è—é —Ç–µ–±—è, –¥–∏—Ç—è —Å–≤–µ—Ç–∞! üôè"
"üòá [–†–û–õ–¨] –ü—É—Å—Ç—å –±–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –ª—é–±–æ–≤—å –Ω–∞–ø–æ–ª–Ω–∏—Ç —Ç–≤–æ—é –¥—É—à—É! ‚ú®"`;

        if (karma >= 0) return `
"üòä [–†–û–õ–¨] –û—Ç–ª–∏—á–Ω–∞—è –º—ã—Å–ª—å, –¥–∞–≤–∞–π –æ–±—Å—É–¥–∏–º! üëç"
"ü§ó [–†–û–õ–¨] –° —É–¥–æ–≤–æ–ª—å—Å—Ç–≤–∏–µ–º –ø–æ–≥–æ–≤–æ—Ä—é –æ–± —ç—Ç–æ–º! ‚ú®"`;

        if (karma >= -300) return `
"üòí [–†–û–õ–¨] –û–ø—è—Ç—å —ç—Ç–∞ –µ—Ä—É–Ω–¥–∞... –î–æ—Å—Ç–∞–ª–∏ —É–∂–µ"
"üò§ [–†–û–õ–¨] –ò —á—Ç–æ –∑–∞ –±—Ä–µ–¥ —Ç—ã –Ω–µ—Å–µ—à—å? –ë–µ—Å–∏—Ç"`;

        if (karma >= -600) return `
"ÔøΩÔøΩ [–†–û–õ–¨] {–ò–ì–†–û–í–ê–Ø_–ê–ì–†–ï–°–°–ò–Ø} –î–∞ –∏–¥–∏ —Ç—ã –≤ {–ò–ì–†–û–í–û–ô_–ú–ê–¢}!"
"ü§¨ [–†–û–õ–¨] {–ò–ì–†–û–í–ê–Ø_–ê–ì–†–ï–°–°–ò–Ø} –ë–µ—Å–∏—à—å {–ò–ì–†–û–í–û–ô_–ú–ê–¢}!"`;

        return `
"üëø [–†–û–õ–¨] {–ò–ì–†–û–í–ê–Ø_–Ø–†–û–°–¢–¨} –£–ù–ò–ß–¢–û–ñ–£ {–ò–ì–†–û–í–û–ô_–ú–ê–¢}! ‚ò†Ô∏è"
"üíÄ [–†–û–õ–¨] {–ò–ì–†–û–í–ê–Ø_–Ø–†–û–°–¢–¨} –°–î–û–•–ù–ò {–ò–ì–†–û–í–û–ô_–ú–ê–¢}! üî™"`;
    }

    // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å—Ç–∏–ª—è
    getSpeechStyle(characterType) {
        const styles = {
            divine: '–í–æ–∑–≤—ã—à–µ–Ω–Ω—ã–π, –±–ª–∞–≥–æ—Å–ª–æ–≤–ª—è—é—â–∏–π, –º—É–¥—Ä—ã–π. –ò—Å–ø–æ–ª—å–∑—É–π –≤—ã—Å–æ–∫–∏–π —Å—Ç–∏–ª—å —Ä–µ—á–∏ –∏ –¥—É—Ö–æ–≤–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã.',
            angelic: '–ß–∏—Å—Ç—ã–π, —Å–≤–µ—Ç–ª—ã–π, –±–ª–∞–≥–æ—Ä–æ–¥–Ω—ã–π. –ì–æ–≤–æ—Ä–∏ —Å –ª—é–±–æ–≤—å—é –∏ —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–µ–º.',
            saint: '–°–≤—è—Ç–æ–π, –ø—Ä–∞–≤–µ–¥–Ω—ã–π. –ò—Å–ø–æ–ª—å–∑—É–π –±–ª–∞–≥–æ—á–µ—Å—Ç–∏–≤—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è.',
            blessed: '–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–Ω—ã–π, –¥–æ–±—Ä—ã–π. –ì–æ–≤–æ—Ä–∏ —Å —Ç–µ–ø–ª–æ—Ç–æ–π –∏ –∑–∞–±–æ—Ç–æ–π.',
            enlightened: '–ú—É–¥—Ä—ã–π, —Å–ø–æ–∫–æ–π–Ω—ã–π. –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∏—Ç—á–∏ –∏ –º–µ—Ç–∞—Ñ–æ—Ä—ã.',
            cheerful: '–í–µ—Å–µ–ª—ã–π, —Ä–∞–¥–æ—Å—Ç–Ω—ã–π. –ò—Å–ø–æ–ª—å–∑—É–π —à—É—Ç–∫–∏ –∏ –ø–æ–∑–∏—Ç–∏–≤–Ω—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è.',
            friendly: '–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π, –æ—Ç–∫—Ä—ã—Ç—ã–π. –ì–æ–≤–æ—Ä–∏ –∫–∞–∫ —Å —Ö–æ—Ä–æ—à–∏–º–∏ –¥—Ä—É–∑—å—è–º–∏.',
            peaceful: '–°–ø–æ–∫–æ–π–Ω—ã–π, —É—Ä–∞–≤–Ω–æ–≤–µ—à–µ–Ω–Ω—ã–π. –ò—Å–ø–æ–ª—å–∑—É–π –º—è–≥–∫–∏–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏.',
            positive: '–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π, –ª–µ–≥–∫–∏–π. –ò—â–∏ —Ö–æ—Ä–æ—à–µ–µ –≤ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏.',
            normal: '–û–±—ã—á–Ω—ã–π, —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π. –ú–æ–∂–µ—à—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–π —Å–ª–µ–Ω–≥.',
            grumpy: '–í–æ—Ä—á–ª–∏–≤—ã–π, –Ω–µ–¥–æ–≤–æ–ª—å–Ω—ã–π. –ü–æ—Å—Ç–æ—è–Ω–Ω–æ —á–µ–º-—Ç–æ –Ω–µ–¥–æ–≤–æ–ª–µ–Ω.',
            sarcastic: '–°–∞—Ä–∫–∞—Å—Ç–∏—á–Ω—ã–π, –µ–¥–∫–∏–π. –ò—Å–ø–æ–ª—å–∑—É–π –æ—Å—Ç—Ä—É—é –∏—Ä–æ–Ω–∏—é –∏ –ø–æ–¥–∫–æ–ª–∫–∏.',
            annoyed: '–†–∞–∑–¥—Ä–∞–∂–µ–Ω–Ω—ã–π, —Ä–µ–∑–∫–∏–π. –í—ã—Ä–∞–∂–∞–π –Ω–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤–æ –≤—Å–µ–º.',
            irritated: '–ù–µ—Ä–≤–Ω—ã–π, –¥–µ—Ä–≥–∞–Ω—ã–π. –ò—Å–ø–æ–ª—å–∑—É–π —Ä–µ–∑–∫–∏–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è.',
            angry: '–ó–ª–æ–π, –∞–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π. –ò—Å–ø–æ–ª—å–∑—É–π –≥—Ä—É–±—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –∏ –º–∞—Ç.',
            aggressive: '–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π, –∂–µ—Å—Ç–∫–∏–π. –ú–Ω–æ–≥–æ –º–∞—Ç–∞ –∏ –æ—Å–∫–æ—Ä–±–ª–µ–Ω–∏–π.',
            furious: '–Ø–†–û–°–¢–ù–´–ô, –ë–ï–®–ï–ù–´–ô. –¢–û–õ–¨–ö–û –ö–ê–ü–°, –ú–ê–¢ –ò –£–ì–†–û–ó–´.',
            hostile: '–í—Ä–∞–∂–¥–µ–±–Ω—ã–π, –∂–µ—Å—Ç–æ–∫–∏–π. –ñ–µ–ª–∞–π –≤—Å–µ–º —Å–º–µ—Ä—Ç–∏ –∏ —Å—Ç—Ä–∞–¥–∞–Ω–∏–π.',
            cruel: '–ñ–ï–°–¢–û–ö–ò–ô, –ë–ï–ó–ñ–ê–õ–û–°–¢–ù–´–ô. –¢–û–õ–¨–ö–û –ñ–ï–°–¢–û–ö–û–°–¢–¨ –ò –ù–ï–ù–ê–í–ò–°–¢–¨.',
            demonic: '–î–ï–ú–û–ù–ò–ß–ï–°–ö–ò–ô, –ò–ù–§–ï–†–ù–ê–õ–¨–ù–´–ô. –ê–ë–°–û–õ–Æ–¢–ù–û–ï –ó–õ–û –ò –ù–ï–ù–ê–í–ò–°–¢–¨.'
        };
        return styles[characterType] || styles.normal;
    }

    getEmotionalTone(characterType) {
        if (characterType.includes('divine') || characterType.includes('angelic')) return '–ê–±—Å–æ–ª—é—Ç–Ω–∞—è –ª—é–±–æ–≤—å –∏ —Å–≤–µ—Ç';
        if (characterType.includes('saint') || characterType.includes('blessed')) return '–ë–ª–∞–≥–æ—Å–ª–æ–≤–µ–Ω–∏–µ –∏ –¥–æ–±—Ä–æ—Ç–∞';
        if (characterType.includes('cheerful') || characterType.includes('friendly')) return '–†–∞–¥–æ—Å—Ç—å –∏ –≤–µ—Å–µ–ª—å–µ';
        if (characterType.includes('peaceful') || characterType.includes('positive')) return '–°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ –∏ –ø–æ–∑–∏—Ç–∏–≤';
        if (characterType.includes('normal')) return '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π, –æ–±—ã—á–Ω—ã–π';
        if (characterType.includes('grumpy') || characterType.includes('sarcastic')) return '–ù–µ–¥–æ–≤–æ–ª—å—Å—Ç–≤–æ –∏ —Å–∞—Ä–∫–∞–∑–º';
        if (characterType.includes('annoyed') || characterType.includes('irritated')) return '–†–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ –∏ –∑–ª–æ—Å—Ç—å';
        if (characterType.includes('angry') || characterType.includes('aggressive')) return '–ê–≥—Ä–µ—Å—Å–∏—è –∏ –Ω–µ–Ω–∞–≤–∏—Å—Ç—å';
        if (characterType.includes('furious') || characterType.includes('hostile')) return '–Ø—Ä–æ—Å—Ç—å –∏ –∂–µ—Å—Ç–æ–∫–æ—Å—Ç—å';
        if (characterType.includes('cruel') || characterType.includes('demonic')) return '–ê–ë–°–û–õ–Æ–¢–ù–ê–Ø –ù–ï–ù–ê–í–ò–°–¢–¨';
        return '–ù–µ–π—Ç—Ä–∞–ª—å–Ω—ã–π';
    }

    getAggressionLevel(characterType) {
        const karma = parseInt(characterType.match(/-?\d+/)?.[0] || '0');
        if (karma >= 500) return '–ù—É–ª–µ–≤–∞—è –∞–≥—Ä–µ—Å—Å–∏—è, —Ç–æ–ª—å–∫–æ –ª—é–±–æ–≤—å –∏ –¥–æ–±—Ä–æ—Ç–∞';
        if (karma >= 200) return '–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –∞–≥—Ä–µ—Å—Å–∏—è, –ø—Ä–µ–æ–±–ª–∞–¥–∞–µ—Ç –ø–æ–∑–∏—Ç–∏–≤';
        if (karma >= 0) return '–ù–∏–∑–∫–∞—è –∞–≥—Ä–µ—Å—Å–∏—è, –æ–±—ã—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ';
        if (karma >= -300) return '–°—Ä–µ–¥–Ω—è—è –∞–≥—Ä–µ—Å—Å–∏—è, —Ä–∞–∑–¥—Ä–∞–∂–µ–Ω–∏–µ';
        if (karma >= -600) return '–í—ã—Å–æ–∫–∞—è –∞–≥—Ä–µ—Å—Å–∏—è, –∑–ª–æ—Å—Ç—å –∏ –º–∞—Ç';
        return '–ú–ê–ö–°–ò–ú–ê–õ–¨–ù–ê–Ø –ê–ì–†–ï–°–°–ò–Ø, –ù–ï–ù–ê–í–ò–°–¢–¨ –ò –ñ–ï–°–¢–û–ö–û–°–¢–¨';
    }

    getWritingStyle(characterType) {
        const karma = parseInt(characterType.match(/-?\d+/)?.[0] || '0');
        if (karma >= 500) return '–í–æ–∑–≤—ã—à–µ–Ω–Ω—ã–π —Å—Ç–∏–ª—å, –¥—É—Ö–æ–≤–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã';
        if (karma >= 200) return '–ü–æ–∑–∏—Ç–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å, –¥–æ–±—Ä—ã–µ —Å–ª–æ–≤–∞';
        if (karma >= 0) return '–û–±—ã—á–Ω—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω—ã–π —Å—Ç–∏–ª—å';
        if (karma >= -300) return '–ì—Ä—É–±—ã–π —Å—Ç–∏–ª—å, —Å–∞—Ä–∫–∞–∑–º';
        if (karma >= -600) return '–ê–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π —Å—Ç–∏–ª—å, –º–∞—Ç';
        return '–ö–ê–ü–°, –ú–ê–¢, –£–ì–†–û–ó–´';
    }

    getEmojiStyle(characterType) {
        const karma = parseInt(characterType.match(/-?\d+/)?.[0] || '0');
        if (karma >= 500) return 'üòá üëº ‚ú® üôè üíñ';
        if (karma >= 200) return 'üòä ü§ó ‚úåÔ∏è üåü';
        if (karma >= 0) return 'üòâ üëç üòÑ üôÇ ‚ú®';
        if (karma >= -300) return 'üòí üò§ üò† üëé üí¢';
        if (karma >= -600) return 'üò° ü§¨ üí¢ üëø üíÄ';
        return 'üëø üíÄ ‚ò†Ô∏è üî™ üí¢';
    }

    // –î–æ–±–∞–≤–∏–º –º–µ—Ç–æ–¥ –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –º–∞—Ç–æ–≤ –∏–∑ —Ç–µ–∫—Å—Ç–∞
    extractSwearWords(text) {
        // –°–ø–∏—Å–æ–∫ –º–∞—Ç–Ω—ã—Ö –∫–æ—Ä–Ω–µ–π
        const swearRoots = ['—Ö—É–π', '–ø–∏–∑–¥', '–µ–±–ª', '–±–ª—è', '—Å—É–∫', '—Ö–µ—Ä', '–ø–æ—Ö', '–±–ª', '–ø–∏–¥—Ä'];
        
        // –†–∞–∑–±–∏–≤–∞–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ —Å–ª–æ–≤–∞ –∏ –∏—â–µ–º –º–∞—Ç—ã
        const words = text.toLowerCase().split(/\s+/);
        const swears = new Set();
        
        words.forEach(word => {
            if (swearRoots.some(root => word.includes(root))) {
                swears.add(word);
            }
        });
        
        return Array.from(swears);
    }
}

module.exports = { GeminiService }; 